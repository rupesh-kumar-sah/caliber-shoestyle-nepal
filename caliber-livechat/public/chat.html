<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caliber Shoes - Customer Support</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 25px;
            text-align: center;
            position: relative;
        }

        .chat-header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .chat-header p {
            font-size: 14px;
            opacity: 0.8;
        }

        .status-indicator {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
            100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.admin, .message.ai {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            position: relative;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.admin .message-bubble {
            background: #e74c3c;
            color: white;
            border-bottom-left-radius: 4px;
        }

        .message.ai .message-bubble {
            background: white;
            color: #2c3e50;
            border: 1px solid #ecf0f1;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }

        .message.user .message-time {
            text-align: right;
        }

        .message.admin .message-time,
        .message.ai .message-time {
            text-align: left;
        }

        .sender-label {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .message.admin .sender-label {
            color: #e74c3c;
        }

        .message.ai .sender-label {
            color: #3498db;
        }

        .typing-indicator {
            display: none;
            padding: 12px 18px;
            background: white;
            border-radius: 18px;
            border: 1px solid #ecf0f1;
            margin-bottom: 20px;
            width: fit-content;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #bdc3c7;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #ecf0f1;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .message-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #ecf0f1;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.3s ease;
            resize: none;
            min-height: 20px;
            max-height: 100px;
            overflow-y: auto;
        }

        .message-input:focus {
            border-color: #667eea;
        }

        .send-button {
            width: 45px;
            height: 45px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }

        .send-button:hover {
            transform: scale(1.05);
        }

        .send-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .voice-button {
            width: 40px;
            height: 40px;
            border: none;
            background: #f39c12;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .voice-button.recording {
            background: #e74c3c;
            animation: recording 1s infinite;
        }

        @keyframes recording {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .scroll-to-bottom {
            position: absolute;
            bottom: 100px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }

            .message-bubble {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>üõçÔ∏è Caliber Shoes Support</h1>
            <p>Talk to our AI assistant or customer service</p>
            <div class="status-indicator" id="statusIndicator"></div>
        </div>

        <div class="messages-container" id="messagesContainer">
            <div class="message ai">
                <div class="message-bubble">
                    <div class="sender-label">Caliber AI</div>
                    <div>Hello! üëã Welcome to Caliber Shoes! I'm your AI assistant, here to help you with anything related to our premium footwear collection. Whether you need product recommendations, order help, or just want to know more about our brand, I'm here to assist you!</div>
                    <div class="message-time" id="welcomeTime"></div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="input-container">
            <textarea
                class="message-input"
                id="messageInput"
                placeholder="Type your message here..."
                rows="1"
            ></textarea>
            <button class="voice-button" id="voiceButton" title="Voice input">
                üé§
            </button>
            <button class="send-button" id="sendButton" disabled>
                ‚û§
            </button>
        </div>
    </div>

    <button class="scroll-to-bottom" id="scrollToBottom" title="Scroll to bottom">
        ‚Üì
    </button>

    <script type="module">
        // Firebase configuration
        const firebaseConfig = {
            // Replace with your Firebase config
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // Initialize Firebase (will be replaced with actual config)
        console.log('Chat interface loaded - waiting for Firebase configuration');

        // DOM elements
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const voiceButton = document.getElementById('voiceButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const scrollToBottom = document.getElementById('scrollToBottom');
        const statusIndicator = document.getElementById('statusIndicator');

        // State
        let currentUser = null;
        let conversationId = null;
        let isListening = false;
        let recognition = null;

        // Initialize the chat
        function initChat() {
            // Generate anonymous user ID
            currentUser = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            conversationId = currentUser;

            // Set welcome message time
            document.getElementById('welcomeTime').textContent = formatTime(new Date());

            // Auto-focus input
            messageInput.focus();

            // Show initial status
            updateConnectionStatus(true);
        }

        // Format time for messages
        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Update connection status
        function updateConnectionStatus(connected) {
            statusIndicator.style.background = connected ? '#27ae60' : '#e74c3c';
        }

        // Add message to chat
        function addMessage(text, sender, timestamp = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const time = timestamp ? new Date(timestamp) : new Date();
            const timeString = formatTime(time);

            messageDiv.innerHTML = `
                <div class="message-bubble">
                    ${sender !== 'user' ? `<div class="sender-label">${sender === 'ai' ? 'Caliber AI' : 'Support Team'}</div>` : ''}
                    <div>${text}</div>
                    <div class="message-time">${timeString}</div>
                </div>
            `;

            messagesContainer.appendChild(messageDiv);
            scrollToBottomMessage();

            return messageDiv;
        }

        // Show typing indicator
        function showTyping() {
            typingIndicator.style.display = 'block';
            scrollToBottomMessage();
        }

        // Hide typing indicator
        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        // Scroll to bottom
        function scrollToBottomMessage() {
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Show/hide scroll button
                const shouldShow = messagesContainer.scrollHeight - messagesContainer.clientHeight > messagesContainer.scrollTop + 100;
                scrollToBottom.style.display = shouldShow ? 'flex' : 'none';
            }, 100);
        }

        // Send message
        async function sendMessage() {
            const text = messageInput.value.trim();
            if (!text || !currentUser) return;

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // Add user message
            addMessage(text, 'user');

            // Show typing indicator
            showTyping();

            try {
                // Send to Firebase (replace with actual Firebase call)
                console.log('Sending message:', { userId: currentUser, text, sender: 'user' });

                // Simulate AI response (replace with actual Firebase function call)
                setTimeout(() => {
                    hideTyping();
                    const responses = [
                        "Thanks for your message! I'd be happy to help you with that. Let me check our collection for you.",
                        "Great question! Our shoes are designed with both style and comfort in mind. Let me give you more details.",
                        "I understand you're looking for the perfect pair! We have some amazing options that might suit your needs.",
                        "Thanks for reaching out! I'm here to help you find exactly what you're looking for in our premium collection."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, 'ai');
                }, 2000);

            } catch (error) {
                console.error('Error sending message:', error);
                hideTyping();
                addMessage('Sorry, I encountered an error. Please try again.', 'ai');
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        messageInput.addEventListener('input', () => {
            // Auto-resize textarea
            messageInput.style.height = 'auto';
            messageInput.style.height = messageInput.scrollHeight + 'px';

            // Enable/disable send button
            sendButton.disabled = !messageInput.value.trim();
        });

        scrollToBottom.addEventListener('click', scrollToBottomMessage);

        // Voice input (optional)
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                voiceButton.classList.add('recording');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                messageInput.dispatchEvent(new Event('input'));
            };

            recognition.onend = () => {
                isListening = false;
                voiceButton.classList.remove('recording');
            };

            voiceButton.addEventListener('click', () => {
                if (!isListening) {
                    recognition.start();
                } else {
                    recognition.stop();
                }
            });
        } else {
            voiceButton.style.display = 'none';
        }

        // Scroll behavior
        messagesContainer.addEventListener('scroll', () => {
            const shouldShow = messagesContainer.scrollHeight - messagesContainer.clientHeight > messagesContainer.scrollTop + 100;
            scrollToBottom.style.display = shouldShow ? 'flex' : 'none';
        });

        // Initialize chat
        initChat();

        // Welcome message
        setTimeout(() => {
            addMessage("How can I help you today? Feel free to ask about our products, orders, or anything else!", 'ai');
        }, 1000);

        console.log('Caliber Shoes Chat Interface Loaded Successfully! üéâ');
    </script>
</body>
</html>
